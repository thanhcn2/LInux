 Role Basic Firewall để làm gì?

 Role Basic Firewall dùng để cài đặt thêm iptables-persistent thiết lập các rule mặc định DROP hết các INPUT chain, OUTPUT chain và FORWARD chain sẽ ACCEPT tất cả.

 Các varlible cần biết.

 01. Sao chép list_ip_add.j2 trong thư mục templates vào file list_ip_add_to_ipset. thay đổi quyền Khi firewall_whitelist is defined và register: whitelist.

- name: copy list ip add to ipset

  template:

    src: list_ip_add.j2

    dest: /opt/list_ip_add_to_ipset

    owner: root

    group: root

    mode: 0644

  when: firewall_whitelist is defined

  register: whitelist

02. Sao chép list_ip_remove.j2 trong thư mục templates vào file list_ip_remove_from_ipset. thay đổi quyền. Khi firewall_removelist is defined và register: removelist.

- name: copy list ip remove from ipset

  template:

    src: list_ip_remove.j2

    dest: /opt/list_ip_remove_from_ipset

    owner: root

    group: root

    mode: 0644

  when: firewall_removelist is defined

  register: removelist

03. sao chép nội dung file script_ipset.sh.j2 vào file script_ipset.sh. phân quyền. khi firewall_whitelist is defined

- name: script add/remove ip to/from ipset

  template:

    src: script_ipset.sh.j2

    dest: /opt/script_ipset.sh

    owner: root

    group: root

    mode: 0644

  when: firewall_whitelist is defined


04. chạy script_ipset.sh khi  firewall_whitelist is defined and (whitelist.changed or removelist.changed)

- name: Run script ipset

  shell: bash /opt/script_ipset.sh

  when: firewall_whitelist is defined and (whitelist.changed or removelist.changed)



05. sao chép nội dung file firewall.sh.j2 trong thư mục templates vào file firewall.sh. thay đổi quyền và register: newfile

- name: copy file

  template:

    src: firewall.sh.j2

    dest: /opt/firewall.sh

    owner: root

    group: root

    mode: 0644

  register: newfile


06.  Add rule khi when: newfile.changed and ansible_distribution_version == '14.04'

- name: Add rule iptables 14.04

  shell: bash /opt/firewall.sh

  notify: save iptables
  
  when: newfile.changed and ansible_distribution_version == '14.04'




Role này dùng để cài Baever và gói pip cần dùng cho baever.


Các biến cần lưu ý.

01. Cài đặt baever version ở đây là mặc định lấy ở các biến var trong file default.

- name: Install beaver

  pip: name=beaver state=present version={{ beaver_version }} 
  executable=/usr/bin/pip


02. sao chép nội dung  file init_beaver.conf.j2 trong templates vào file  /etc/init/beaver.conf. khi máy chủ là ubuntu.

 - name: Modify beaver Upstart file

  template:

    src: init_beaver.conf.j2

    dest: /etc/init/beaver.conf

  when: ansible_distribution == 'Ubuntu' and ansible_distribution_release == 'precise' or ansible_distribution_release == 'trusty'

03. Sao chép nội dung file beaver.service trong templates vào file /lib/systemd/system/beaver.service khi máy chủ là ubuntu.

 - name: Modify beaver Systemd file

  template:

    src: beaver.service

    dest: /lib/systemd/system/beaver.service

  when: ansible_distribution == 'Ubuntu' and ansible_distribution_release == 'xenial' or ansible_distribution_release == 'bionic'

04. Sao chép nội dung file beaver.conf.j2 trong templates vào file /etc/beaver/beaver.conf và khởi động lại service.

- name: Configure beaver.conf

  template:

    src: beaver.conf.j2

    dest: /etc/beaver/beaver.conf

  notify: 

    - restart beaver
    - restart beaver xenial

05. Sao chép tất cả các file có đuôi .conf vào thư mục conf.d và khởi động lại baever

- name: Copy conf to /etc/beaver/conf.d

  copy:

    src: "{{item}}"

    dest: /etc/beaver/conf.d/

  with_fileglob:

    - ./*.conf

  notify: 
  
    - restart beaver
    - restart beaver xenial


    




Role đấy làm gì?

Role đấy dùng để cài đặt Diamond và các gói cần thiết.

Các varlible cần lưu ý.


01. Install python-ovs-vsctl từ trên thư viện git


- name: Install python-ovs-vsctl

  command: pip install git+https://github.com/iwaseyusuke/python-ovs-vsctl.git



02. cài đặt python packages lấy thông tin ở trong folder default


 - name: Ubuntu16.04 or Ubuntu18.04 | Install python library

  pip: name="{{ item }}" state=latest

  with_items:

    - "{{ python_packages }}"


03. Sao chép nội dung file diamond.conf.u16.04.j2 trong templates vào file diamond.conf phân quyền và khởi động lại

- name: Ubuntu16.04 or Ubuntu18.04 | create diamond.conf

  template:

    src=diamond.conf.u16.04.j2

    dest=/etc/diamond/diamond.conf

    mode=0644

    owner=root

    group=root

  notify:

    - restart diamond


04. sao chép nội dung  file diamondcollectorconf.j2 vào tất cả các file có đuôi .conf trong thư mục /etc/diamond/collectors/ với điều kiện của file diamond_collector_common_defs nằm trong folder default và khởi động lại.

- name: Ubuntu16.04 or Ubuntu18.04 | Configuring common collectors

  template: src=diamondcollectorconf.j2 

  dest="/etc/diamond/collectors/{{item.key}}.conf"

  with_dict: "{{ diamond_collector_common_defs }}"

  notify:

    - restart diamond


05. tự khơi động lại diamon khi diamond_cronjob = true. file mặc định ở default là diamond_cronjob: false

- name: add cronjob restart diamond

  cron:

    name: restart diamond

    minute: 0

    hour: 2

    user: root

    job: "service diamond restart >/dev/null 2>&1"

  when: '{{ diamond_cronjob }} == true'









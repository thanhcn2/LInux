Role đấy làm gì?

role này dung để cài nagios plugins và nagios-nrpe-server.

các biến cần lưu ý.

1. xác định các server sẽ được liên kết đến nrpe-server

allowed_hosts:
  - 172.30.3.13
  - 172.30.8.3
  - 172.30.8.40
  
dont_blame_nrpe = 0

command_timeout: 60



02. Xác dịnh đường dẫn file và phân quyền.
tài khoản.

- name: Ensure plugins folder exists
  file:

    path: "{{ vccloud_plugins_folder }}"

    state: directory

    owner: nagios

    group: nagios

    mode: 0775

03. Sao chép tất cả các plugins về thư mục vccloud_plugins_folder. xong rồi khởi động lại.

name: Copy nrpe plugins

  synchronize:

    src: ./plugins/

    dest: "{{ vccloud_plugins_folder }}"

    delete: yes

    recursive: yes

  notify: restart nrpe


04. sao chép file templates nrpe.cfg về thư mục nagios.

name: Configure nrpe.cfg

  template:

    src: nrpe.cfg.j2

    dest: /etc/nagios/nrpe.cfg

    owner: root

    group: root

    mode: 0644

  notify: restart nrpe


05. Dùng file templates nagios_sudoer.j2 cấp quyền root.

 name: Allow nagios sudo permission

  template:

    src: nagios_sudoer.j2

    dest: /etc/sudoers.d/nagios

    owner: root

    group: root

    mode: 0644

  when: allow_nagios_sudo


